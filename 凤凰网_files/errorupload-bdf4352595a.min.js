/*!
 * @module report
 * @author kael, chriscai
 * @date @DATE
 * Copyright (c) 2014 kael, chriscai
 * Licensed under the MIT license.
 */
!function(e){"use strict";e.console||(e.console={});for(var r,t,n=e.console,o=function(){},i=["memory"],a="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");r=i.pop();)n[r]||(n[r]={});for(;t=a.pop();)n[t]||(n[t]=o)}("undefined"==typeof window?this:window);var BJ_REPORT=function(e){var r=[],t={},n={namespace:"",appname:"",url:"",hb_url:"",ext:null,level:4,ignore:[],random:1,delay:2e3,submit:null,repeat:5,uid:"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=16*Math.random()|0;return("x"==e?r:3&r|8).toString(16)})),bid:"",router:"",perf_url:"",perf_filter_list:[],perf_timeout:0,pref_count:0},o=window.location.href.match(/debugid\=([a-zA-Z0-9]+)/),i=o?o[1]:"",a=l("sid"),c=l("userid"),s="undefined"!=typeof __domAliveNum?__domAliveNum:100,d=!1;navigator&&navigator.userAgent&&/(Baiduspider)|(spider.html)/gi.test(navigator.userAgent)&&(d=!0);function u(e){if(!isNaN(e))return e;var r=0;switch(e){case"ui":r=1;break;case"ad":r=2;break;case"data":r=3;break;case"api":r=4;break;case"alive":r=5;break;case"document.body":r=6;break;case"match":r=7;break;case"prevent":r=8;break;case"performance":r=9;break;case"inject":r=10;break;case"whitescreen":r=11;break;case"routematchgood":r=12;break;case"slowApi":r=13;break;case"noWhitescreen":r=14;break;case"photoswipe":r=15;break;case"slide_live_bad":r=16;break;case"slide_live_good":r=17;break;case"wx_share_ajax":r=18;break;case"wx_share_err":r=19;break;case"defer":r=20;break;case"no_vivo":r=21;break;case"vivo_perf":r=22;break;case"not_support_perf":r=23;break;default:r=0}return r}function l(e){try{var r=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=r?unescape(r[2]):null}catch(t){console&&console.error(t)}}function p(e,r){d||((new Image).src=e)}function f(){try{var e={};if(document.body){try{e.r=document.getElementById("root").getElementsByTagName("*").length}catch(r){e.r=0,console&&console.error(r)}return e}return{description:"document.body is not ok"}}catch(r){return console&&console.error(r),e}}function g(){return document.addEventListener?function(e,r,t,n){e.addEventListener(r,t,n||!1)}:function(e,r,t){e.attachEvent("on"+r,(function(r){t.call(e,r)}))}}function m(){try{var e=window.performance;if(!e)return;var r=[],t=e.timing;if(t){var n=undefined,o=undefined;try{var i=e.getEntriesByType("paint");i&&i.length>0&&(i[0]&&i[0].startTime&&(n=parseInt(i[0].startTime)),i[1]&&i[1].startTime&&(o=parseInt(i[1].startTime)))}catch(g){}var a={};a.loadPage=t.domComplete-t.fetchStart,a.domReady=t.domContentLoadedEventEnd-t.fetchStart,a.redirect=t.redirectEnd-t.redirectStart,a.appcache=t.domainLookupStart-t.fetchStart,a.dns=t.domainLookupEnd-t.domainLookupStart,a.tcp=t.connectEnd-t.connectStart,a.ttfb=t.responseStart-(t.navigationStart||t.fetchStart),a.request=t.responseEnd-t.requestStart,a.response=t.responseEnd-t.responseStart,a.loadEvent=t.loadEventEnd-t.loadEventStart,a.unloadEvent=t.unloadEventEnd-t.unloadEventStart,a.name=window.location.href.replace(/\?.*/,""),a.fp=n,a.fcp=o,a.didmount=(bj_config.didMountEndTime>0?bj_config.didMountEndTime:new Date-0)-t.fetchStart,a.first_screen=(bj_config.firstScreenEndtime>0?bj_config.firstScreenEndtime:new Date-0)-t.fetchStart,r.push(a)}if(e.getEntries)for(var c=e.getEntries("*"),s=0,d=c.length;s<d;s++){var u=c[s];if(0==s&&r.length>0)r[0].duration=parseInt(u.duration),parseInt(u.domComplete)>0&&(r[0].loadPage=parseInt(u.domComplete)),parseInt(u.domContentLoadedEventEnd)>0&&(r[0].domReady=parseInt(u.domContentLoadedEventEnd));else if("object"==typeof __perfUrlUpload)for(var l={name:u.name,duration:parseInt(u.duration),_duration:parseInt(u.responseEnd-u.startTime),redirect:parseInt(u.redirectEnd-u.redirectStart),appcache:parseInt(u.domainLookupStart-u.fetchStart),dns:parseInt(u.domainLookupEnd-u.domainLookupStart),tcp:parseInt(u.connectEnd-u.connectStart),request:parseInt(u.responseStart-u.requestStart),response:parseInt(u.responseEnd-u.responseStart),fp:parseInt(u.fetchStart),fcp:parseInt(u.responseEnd)},p=0;p<__perfUrlUpload.length;p++){var f=__perfUrlUpload[p];u.name&&u.name.indexOf(f)>-1&&r.push(l)}}return r}catch(g){return console&&console.error(g),[]}}var h={isOBJByType:function(e,r){return Object.prototype.toString.call(e)==="[object "+(r||"Object")+"]"},isOBJ:function(e){return"object"===typeof e&&!!e},isEmpty:function(e){return null===e||!h.isOBJByType(e,"Number")&&!e},extend:function(e,r){for(var t in r)e[t]=r[t];return e},processError:function(e){try{if(e.stack){var r=e.stack.match('https?://[^\n"]+'),t=(r=r?r[0]:"").match(/:(\d+):(\d+)\)?/);t||(t=[0,0,0]);var n=h.processStackMsg(e),o=e.type?e.type:0;return{msg:e.toString(),type:o,rowNum:t[1],colNum:t[2],target:r.replace(t[0],""),_orgMsg:n}}o=e.type?e.type:0;return e.name&&e.message&&e.description?{msg:JSON.stringify(e),type:o,rowNum:0,colNum:0,target:"null"}:e}catch(err){return e}},processStackMsg:function(e){var r=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),t=e.toString();return r.indexOf(t)<0&&(r=t+"@"+r),r},isRepeat:function(e){if(!h.isOBJ(e))return!0;var r=e.msg;return(t[r]=(parseInt(t[r],10)||0)+1)>n.repeat}},v=e.onerror;e.onerror=function(r,t,n,o,i){try{var a=r;i&&i.stack&&(a=h.processStackMsg(i)),h.isOBJByType(a,"Event")&&(a+=a.type?"--"+a.type+"--"+(a.target?a.target.tagName+"::"+a.target.src:""):""),a+=", alive："+JSON.stringify(f()),R.push({msg:a,target:t,rowNum:n,colNum:o,_orgMsg:a,type:0}),b(),v&&v.apply(e,arguments)}catch(i){console&&console.error(i)}};var w=function(e,r){try{var t=[],o={},i=[];if(h.isOBJ(e))for(var a in e.level=e.level||n.level,e){var c=e[a];if(h.isOBJ(c))try{c=JSON.stringify(c)}catch(err){c="[BJ_REPORT detect value stringify error] "+err.toString()}"rowNum"!==a&&"colNum"!==a||(c=isNaN(c)?0:c,c=Number(c)),i.push(a+":"+c),t.push(a+"="+encodeURIComponent(c)),o[a]=c}return[o,i.join(","),t.join("&")]}catch(e){console&&console.error(e)}},_=[],y=0,E=function(){try{if(clearTimeout(y),y=0,!_.length)return;var e={namespace:n.namespace,appname:n.appname,count:_.length,_t:new Date-0,bid:n.bid,url:n.router,data:_,uid:n.uid};i&&(e.debugid=i),a&&(e.sid=a),c&&(e.userid=c),p(n._reportUrl+"?e="+encodeURIComponent(JSON.stringify(e))),_=[]}catch(r){console&&console.error(r)}},b=function(e){try{if(!n._reportUrl)return;for(var t=Math.random()>=n.random;r.length;){var o=!1,i=r.shift();if(i.msg=(i.msg+""||"").substr(0,3e3),!h.isRepeat(i)){var a=w(i,_.length);if(h.isOBJByType(n.ignore,"Array"))for(var c=0,s=n.ignore.length;c<s;c++){var d=n.ignore[c];if(h.isOBJByType(d,"RegExp")&&d.test(a[1])||h.isOBJByType(d,"Function")&&d(i,a[1])){o=!0;break}}o||t||20==i.level||(_.push(a[0]),n.onReport&&n.onReport(n.namespace,i))}}e?E():y||(y=setTimeout(E,n.delay))}catch(u){console&&console.error(u)}},R=e.BJ_REPORT={push:function(e){try{var t=h.isOBJ(e)?h.processError(e):{msg:e};if(t.from||(t.from=location.href),t._orgMsg){var n=t._orgMsg;delete t._orgMsg,t.level=2;var o=h.extend({},t);o.level=4,o.msg=n,r.push(o)}else r.push(t);return b(),R}catch(i){console&&console.error(i)}},report:function(e,r,t){try{return"object"==typeof e&&(e.message+=", alive："+JSON.stringify(f())),e&&(e.type=u(t),R.push(e)),r&&b(!0),R}catch(n){console&&console.error(n)}},report:function(e,r,t){try{return"object"==typeof e&&(e.message+=", alive："+JSON.stringify(f())),e&&(e.type=u(t),R.push(e)),r&&b(!0),R}catch(n){console&&console.error(n)}},handleError:function(e,r,t,n,o){try{var i=e;o&&o.stack&&(i=h.processStackMsg(o)),h.isOBJByType(i,"Event")&&(i+=i.type?"--"+i.type+"--"+(i.target?i.target.tagName+"::"+i.target.src:""):""),i+=", alive："+JSON.stringify(f()),R.push({msg:i,target:r,rowNum:t,colNum:n,_orgMsg:i,type:0}),b()}catch(o){console&&console.error(o)}},heartbeat:function(){try{var e={namespace:n.namespace,appname:n.appname,route:n.router,url:window.location.href};p(n.hb_url+"?d="+encodeURIComponent(JSON.stringify(e)))}catch(r){console&&console.error(r)}},touchstart:function(){window.addEventListener("touchstart",(function e(r){try{var t={namespace:n.namespace,appname:n.appname,route:"/touchstart/"+n.router,url:window.location.href};p(n.hb_url+"?d="+encodeURIComponent(JSON.stringify(t)))}catch(o){console&&console.error(o)}window.removeEventListener("touchstart",e,!1)}),!1)},performace:function(){var r=!1;function t(t){if(!r){r=!0;undefined;var o={namespace:n.namespace,appname:n.appname,route:n.router,_t:new Date-0,uid:n.uid,bid:n.bid,sid:a,userid:c,event:t,url:e.location.href.replace(/\?.*/,""),network:navigator&&navigator.connection&&navigator.connection.effectiveType,requests:m()};p(n.perf_url+"?d="+encodeURIComponent(JSON.stringify(o)))}}g()(document,"DOMContentLoaded",(function(e){if(performance.getEntries)for(var r=performance.getEntries(),t=0,o=r.length;t<o;t++){var i=r[t];i.name&&(i.name.indexOf(".css")>-1||i.name.indexOf(".js")>-1)&&n.perf_filter_list.push(i.name)}})),g()(window,"load",(function(e){setTimeout((function(){t("load")}),300)})),g()(window,"beforeunload",(function(e){t("beforeunload")})),g()(window,"unload",(function(e){t("unload")}))},firstScreen:function(){bj_config.didMountEndTime<0&&(bj_config.didMountEndTime=new Date-0),setTimeout((function(){bj_config.firstScreenEndtime<0&&(bj_config.firstScreenEndtime=new Date-0)}),1)},injection:function(){g()(window,"load",(function(e){try{!0,r="//p1.ifengimg.com/a/2018/0920/injection.html?namespace="+n.namespace+"&appname="+n.appname+"&uid="+n.uid+"&router="+n.router,(t=document.createElement("iframe")).src=r,t.width=0,t.height=0,t.style&&(t.style.display="none"),document.body.appendChild(t)}catch(o){console&&console.error(err)}var r,t}))},alive:function(){setTimeout((function(){try{if(document.body){if(f().r<s){var e=new Error("alive error");window&&window.BJ_REPORT&&window.BJ_REPORT.report(e,!1,"alive"),r=setInterval((function(){if(f().r>s&&window&&window.BJ_REPORT){clearInterval(r);var e=new Error("5s验活失败后恢复正常");window.BJ_REPORT.report(e,!1,"noWhitescreen")}}),2e3)}else!function(){var e=setInterval((function(){if(f().r<s&&window&&window.BJ_REPORT){clearInterval(e);var r=new Error("页面从正常变白");window.BJ_REPORT.report(r,!1,"whitescreen")}}),2e3)}()}else{e=new Error("document.body is null");window&&window.BJ_REPORT&&window.BJ_REPORT.report(e,!1,"document.body")}}catch(t){console&&console.error(t)}var r}),5e3)},mainPagecheck:function(){var e;e=setInterval((function(){console.log("checkToBad",Math.random());var r=document.getElementById("slide"),t=null;r?r.getBoundingClientRect()?r.getBoundingClientRect().width>0&&r.getBoundingClientRect().height>0||(t=new Error("slide宽度和高度异常, width: "+r.getBoundingClientRect().width+",height:"+r.getBoundingClientRect().height)):t=new Error("获取不到getBoundingClientRect()方法"):t=new Error("找不到id为slide的元素"),t&&(clearInterval(e),window&&window.BJ_REPORT&&(window.BJ_REPORT.report(t,!1,"slide_live_bad"),function(){var e=setInterval((function(){console.log("checkToGood",Math.random());var r=document.getElementById("slide");if(r&&r.getBoundingClientRect()&&r.getBoundingClientRect().width>0&&r.getBoundingClientRect().height>0){clearInterval(e);var t=new Error("slide宽度和高度恢复正常, width: "+r.getBoundingClientRect().width+",height:"+r.getBoundingClientRect().height);window&&window.BJ_REPORT&&window.BJ_REPORT.report(t,!1,"slide_live_good")}}),3e3)}()))}),3e3)},matchAutoRepair:function(){var e=setInterval((function(){if(f().r>s&&window&&window.BJ_REPORT){clearInterval(e);var r=new Error("路由错配，页面正常显示");window.BJ_REPORT.report(r,!1,"routematchgood")}}),2e3)},info:function(e){return e?(h.isOBJ(e)?e.level=2:e={msg:e,level:2},R.push(e),R):R},debug:function(e){return e?(h.isOBJ(e)?e.level=1:e={msg:e,level:1},R.push(e),R):R},init:function(t){try{if(h.isOBJ(t))for(var o in t)n[o]=t[o];return n.namespace&&n.appname&&(n._reportUrl=n.url),n.router||(n.router=e.location.href.replace(/\?.*/,"")),n.bid||(n.bid="null"),r.length&&b(),R}catch(i){console&&console.error(i)}},__onerror__:e.onerror};return"undefined"!=typeof console&&console.error&&setTimeout((function(){var e=((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2];e&&console.error("BJ_ERROR",decodeURIComponent(e).replace(/(:\d+:\d+)\s*/g,"$1\n"))}),0),R}(window);"undefined"!=typeof module&&(module.exports=BJ_REPORT),bj_config.config.url="https://err.ifengcloud.ifeng.com/v1/api/err",bj_config.config.hb_url="https://err.ifengcloud.ifeng.com/v1/api/hb",bj_config.config.perf_url="https://err.ifengcloud.ifeng.com/v1/api/perf",BJ_REPORT.init(bj_config.config),"object"!=typeof bj_func_list&&(bj_func_list=["heartbeat","performace"]);for(var i=0;i<bj_func_list.length;i++){BJ_REPORT[action=bj_func_list[i]]()}if(bj_config&&bj_config.cache_error_list&&bj_config.cache_error_list.length>0){i=0;for(var len=bj_config.cache_error_list.length;i<len;i++){var action=bj_config.cache_error_list[i][0],args=bj_config.cache_error_list[i][1];window.BJ_REPORT[action].apply(this,args)}bj_config.cache_error_list=[]}!function(e){var r,t=function(r){e.BJ_REPORT&&e.BJ_REPORT&&e.BJ_REPORT.push&&e.BJ_REPORT.push(r)},n={};e.tryJs=function(e){return e&&(t=e),n};var o=function(n,o){return function(){try{return n.apply(this,o||arguments)}catch(a){try{a.message=a.message+n.toString()}catch(err){}if(t(a),a.stack&&console&&console.error&&console.error("[BJ-REPORT]",a.stack),!r){var i=e.onerror;e.onerror=function(){},r=setTimeout((function(){e.onerror=i,r=null}),50)}throw a}}},i=function(e){return function(r,t){if("string"==typeof r)try{r=new Function(r)}catch(err){throw err}var n=[].slice.call(arguments,2);return r=o(r,n.length&&n),e(r,t)}};n.spySystem=function(){return e.setTimeout=i(e.setTimeout),e.setInterval=i(e.setInterval),n},n.spyAll=function(){return n.spySystem(),n}}(window),window&&window.tryJs&&window.tryJs().spyAll();
//# sourceMappingURL=errorupload-f348bc846f.min.js.map
